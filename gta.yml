launch:
    parameters:
        - instnaceSize:
            description: Instnace size
            default: "m1.medium"
            enum:
                "m1.medium": "m1.medium"
                "m1.large": "m1.large"
    steps:
        - node-provision:
            action: compute.grow
            parameters:
                ec2SecurityGroup: ATG
                imageId: us-east-1/ami-3ce23f55
                hardwareId: $instnaceSize
            output:
                host: ips
        - artifacts-download:
               action: install
               parameters:
                    phase: "download"
                    runList: ["recipe[atg::artifacts]"]
        - node-init:
               action: install
               parameters:
                    phase: "init"
                    precedingPhases: ["download"]
                    runList: ["recipe[atg::init]"]
        - mysql-install:
               action: install
               parameters:
                    phase: "mysql"
                    precedingPhases: ["init"]
                    runList: ["recipe[atg::mysql]"]
        - java-install:
               action: install
               parameters:
                    phase: "java"
                    precedingPhases: ["mysql"]
                    runList: ["recipe[atg::java]"]
        - jboss-install:
               action: install
               parameters:
                    phase: "jboss"
                    precedingPhases: ["java"]
                    runList: ["recipe[atg::jboss]"]
        - profile-setup:
               action: install
               parameters:
                    phase: "profile"
                    precedingPhases: ["jboss"]
                    runList: ["recipe[atg::profile]"]
        - agt-core-install:
               action: install
               parameters:
                    phase: "atg-core"
                    precedingPhases: ["profile"]
                    runList: ["recipe[atg::atg-core]"]
        - agt-crs-install:
               action: install
               parameters:
                    phase: "atg-crs"
                    precedingPhases: ["atg-core"]
                    runList: ["recipe[atg::atg-crs]"]
        - agt-cim-configuration:
               action: install
               parameters:
                    phase: "atg-cim"
                    precedingPhases: ["atg-crs"]
                    runList: ["recipe[atg::atg-cim]"]
        - jboss-startup:
               action: install
               parameters:
                    phase: "post"
                    precedingPhases: ["atg-cim"]
                    runList: ["recipe[atg::post]"]
    return:
            reference-store:
                description: ATG Commerce Reference Store
                value: http://${host}:8080/crs

destroy:
    steps:
        - destroy-vm:
            action: undeployEnv
            parameters:
                phase: destroy
