launch:
    parameters:
        - instnaceSize:
            description: Instnace size
            default: "m1.small"
            enum:
                "m1.small": "m1.small"
    steps:
        - node-provision:
            action: compute.grow
            parameters:
                ec2SecurityGroup: atg
                hardwareId: $instnaceSize
                roleName: node1
            output:
                host: ips
        - another-node-provision:
            action: compute.grow
            parameters:
                ec2SecurityGroup: atg
                hardwareId: $instnaceSize
                roleName: node2
            output:
                another_host: ips
        - command:
            action: execrun
            parameters:
                phase: date
                roles: ["node1"]
                precedingPhases: [provision]
                command:
                  - hostname
            output:
                node1_hosthane: stdout
        - command:
            action: execrun
            parameters:
                phase: whoami
                roles: ["node2"]
                precedingPhases: [provision]
                command:
                  - hostname
            output:
                node2_hosthane: stdout
    return:
        - ip:
            value: ${host}
        - node1_hosthane:
            value: ${node1_hosthane}
        - node2_hosthane:
            value: ${node2_hosthane}

arbitraryCommand:
    parameters:
        - command:
            description: Comamnd
    steps:
        - command:
            action: execrun
            parameters:
                phase: execute
                roles: ["defaultRole"]
                precedingPhases: [provision]
                command:
                     - $command
            output:
                stdout: stdout
                stderr: stderr
    return:
        - stdout:
            value: ${stdout}
        - stderr:
            value: ${stderr}


destroy:
  steps:
    - undeployEnv:
        action: "undeployEnv"
        parameters:
          phase: "destroy"
