launch:
    parameters:
        - instnaceSize:
            description: Instnace size
            default: "m1.small"
            enum:
                "m1.small": "m1.small"
    steps:
        - node-provision:
            action: compute.grow
            parameters:
                ec2SecurityGroup: atg
                hardwareId: $instnaceSize
            output:
                host: ips
        - command:
            action: execrun
            parameters:
                phase: execute
                roles: ["defaultRole"]
                precedingPhases: [provision]
                command: date
            output:
                date: stdout
        - command:
            action: execrun
            parameters:
                phase: execute
                roles: ["defaultRole"]
                precedingPhases: [provision]
                command: whoami
            output:
                currentuser: stdout
        - command:
            action: execrun
            parameters:
                phase: execute
                roles: ["defaultRole"]
                precedingPhases: [provision]
                command: ls /home/ubuntu/.undeploy.me
            output:
                files: stdout
    return:
        - ip:
            value: ${host}
        - date:
            value: ${date}
        - currentuser:
            value: ${currentuser}
        - work_dir_files:
            value: ${files}

arbitraryCommand:
    parameters:
        - command:
            description: Comamnd
    steps:
        - command:
            action: execrun
            parameters:
                phase: execute
                roles: ["defaultRole"]
                precedingPhases: [provision]
                command:
                     - $command
            output:
                stdout: stdout
                stderr: stderr
    return:
        - stdout:
            value: ${stdout}
        - stderr:
            value: ${stderr}


destroy:
  steps:
    - undeployEnv:
        action: "undeployEnv"
        parameters:
          phase: "destroy"
